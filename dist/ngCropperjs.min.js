!function(){"use strict";angular.module("ngCropper",["ng"]).directive("ngCropper",["$q","$parse",function(i,a){return{restrict:"A",scope:{options:"=ngCropperOptions",showEvent:"=ngCropperShow",hideEvent:"=ngCropperHide",proxy:"=?ngCropperProxy"},link:function(t,n,e){var r,o=!1;t.$on(t.showEvent,function(){o||(o=!0,function(e,t){e=e||{};var n=i.when(e);e.maximize&&(n=function(t,e){return function(e){var t=i.defer(),n=new Image;return n.onload=function(){t.resolve({width:n.width,height:n.height})},n.src=e.src,t.promise}(e).then(function(e){return t.data=e,t})}(e,t));return n}(t.options,n[0]).then(function(e){r=new Cropper(n[0],e),function(){if(!t.proxy)return;a(t.proxy).assign(t.$parent,function(e){r[e]()})}()}))}),t.$on(t.hideEvent,function(){o&&(o=!1,r.destroy())}),t.$watch("options.disabled",function(e){o&&(e&&r.disable(),e||r.enable())})}}}]).service("Cropper",["$q",function(r){function e(e){var t=r.defer(),n=new Image;return n.onload=function(e){t.resolve(e.target)},n.src=e,t.promise}function p(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.style.display="none",document.body.appendChild(t),t}function f(e){e.parentElement.removeChild(e)}this.encode=function(e){var t=r.defer(),n=new FileReader;return n.onload=function(e){t.resolve(e.target.result)},n.readAsDataURL(e),t.promise},this.decode=function(e){for(var t=e.split(";")[0].split(":")[1],n=atob(e.split(",")[1]),r=new Uint8Array(n.length),o=0;o<n.length;o++)r[o]=n.charCodeAt(o);return new Blob([r],{type:t})},this.crop=function(r,o){var i=this.decode;return this.encode(r).then(e).then(function(e){var t=p(o);t.getContext("2d").drawImage(e,o.x,o.y,o.width,o.height,0,0,o.width,o.height);var n=t.toDataURL(r.type);return f(t),i(n)})},this.scale=function(u,d){var s=this.decode;return this.encode(u).then(e).then(function(e){var t,n,r,o=e.height,i=e.width;angular.isNumber(d)&&(n=o*(t=d),r=i*t),angular.isObject(d)&&(t=i/o,n=d.height,r=d.width,n&&!r?r=n*t:r&&!n&&(n=r/t));var a=p(d),h=a.getContext("2d");a.height=n,a.width=r,h.drawImage(e,0,0,i,o,0,0,r,n);var c=a.toDataURL(u.type);return f(a),s(c)})}}])}();
